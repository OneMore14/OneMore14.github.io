---
layout: post
title:  "write an OS in Rust"
date:   2022-12-14 15:19:01 +0800
tags: "rust"
typora-root-url: ../../../
---



原po地址https://os.phil-opp.com/，在此记录一些知识点



#### stack unwinding

https://stackoverflow.com/questions/2331316/what-is-stack-unwinding



stack unwinding主要指函数调用结束后由runtime清理stack frame中的本地变量(调用析构函数)。正常情况下子函数返回后就释放资源，但如果遇到子函数抛异常，也需要正确释放资源，否则造成内存泄露。 stack unwinding需要用到OS提供的能力，[libunwind](https://www.nongnu.org/libunwind/)



#### rust start entry

rust有非常小的runtime，所以程序的起始位置并不是main函数本身，而是首先有一个C runtime library called crt0 ("C runtime zero")，然后这个C runtime再调用the entry point of the rust runtime, which is marked by the `start` language item



#### target triple

`x86_64-unknown-linux-gnu` 各项的含义 https://clang.llvm.org/docs/CrossCompilation.html#target-triple



#### cross compile

A cross compiler is a compiler capable of creating executable code for a platform other than the one on which the compiler is running.



#### VGA text buffer

把字符串写到物理位置0xb8000(彩色模式)就好，机器会自动在屏幕打印出字符。屏幕上能显示的字符数是固定的，屏幕填满需要继续显示下一行时，就移动之前的字符位置空出一行。

0xb8000地址是通过memory-mapped I/O来访问，所以实际上并不是访问的RAM，而是VGA的硬件。

a fundamental property of UTF-8: the individual bytes of multi-byte values are never valid ASCII.



####  Volatile

一个变量如果只往里写入，从来不读取的话，编译器可能会对写入进行优化。如果要避免错误优化，需要显式设置写入为*[volatile](https://en.wikipedia.org/wiki/Volatile_(computer_programming))* This tells the compiler that the write has side effects and should not be optimized away.



#### Spinlock

线程不断轮训资源是否可用，在锁很快被释放的情况下效率比较高，需要硬件支持(吧？)



####  I/O Ports

CPU和外设交互除了已经用到的**memory-mapped I/O** 外还有 **port-mapped I/O**，通过端口号写入或读取数据。

To communicate with such an I/O port, there are special CPU instructions called `in` and `out`, which take a port number and a data byte(当然也不一定都是byte)



#### Serial Port

The chips implementing a serial interface are called [UARTs](https://en.wikipedia.org/wiki/Universal_asynchronous_receiver-transmitter). 



#### unit and integration testing

单元测试原理就是
